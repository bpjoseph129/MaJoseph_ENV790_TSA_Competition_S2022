---
title: "ForecastCompetition"
author: "Ben and Yiyan"
date: "4/3/2022"
output: pdf_document
---

Questions for Luana:
- How to select all weather stations when mutating from hrly to daily
- How to deal with the large txt file issue

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
```

## Data Cleaning

At this step, we cleaned the load, temperature, and humidity datasets. First we imported our datasets. Then we averaged the hourly temperature and humidity across all weather stations. Then we cleaned these datasets and hour hourly load data to return daily average temperature and humidity across all weather stations. This process resulted in the following three dataframes.

##creating daily data
```{r read_data, warning=FALSE}
library(readxl)
load <- read_excel("Data/load.xlsx")
humidity <- read_excel("Data/relative_humidity.xlsx")

empty_col2<-("humidity_average")
humidity[,empty_col2]<-NA
humidity$humidity_average<-rowMeans(humidity[,(3:30)])

temp <- read_excel("Data/temperature.xlsx")
empty_col3<-("temp_average")
temp[,empty_col3]<-NA
temp$temp_average<-rowMeans(temp[,(3:30)])

#Fixing date columns and selecting active power only column
humidity_2 <- humidity %>% 
  mutate( Date = ymd(date)) %>% 
  mutate( Year = year(date), 
          Month = month(date), 
          Day = day(date)) %>% 
  select( Date, Year, Month, Day, humidity_average)

temp_2 <- temp %>% 
  #mutate( rh_ws1 = as.numeric(rh_ws1)) %>%  
  mutate( Date = ymd(date)) %>% 
  #mutate( hr = hms(Time)) %>% 
  mutate( Year = year(date), 
          Month = month(date), 
          Day = day(date)) %>% 
          #Hour = hour(Time), 
          #Min = minute(Time)) %>% 
  select( Date, Year, Month, Day, temp_average)


#Creating a data frame with daily observations
humidity_daily <- humidity_2 %>% 
  filter( !is.na(humidity_average)) %>% 
  group_by(Date,Year,Month,Day) %>% # here we left column with hour out to calculate daily mean
  summarise( daily_humidity_average = mean(humidity_average)) 


#Creating a data frame with daily observations
temp_daily <- temp_2 %>% 
  filter( !is.na(temp_average)) %>% 
  group_by(Date,Year,Month,Day) %>% # here we left column with hour out to calculate daily mean
  summarise(daily_temp_average = mean(temp_average))

empty_col <- ("Daily Average")
load[,empty_col] <- NA
load$`Daily Average` <- rowMeans(load[,(3:26)])

load <- load[-c(1,3:26)]
temp_daily<-temp_daily[,-c(2:4)]
humidity_daily<-humidity_daily[,-c(2:4)]

#Display output
head(load, 10)
head(temp_daily, 10)
head(humidity_daily, 10)
```

## creating ts object and creating test and training data

You can also embed plots, for example:

```{r pressure, echo=FALSE}

#make load a ts object

ts_load <- msts(load$`Daily Average`, 
                           seasonal.periods =c(7,365.25),
                           start=c(2005,1,1))
ts_temp_daily <- msts(temp_daily$daily_temp_average,
                           seasonal.periods =c(7,365.25),
                           start=c(2005,1,1))
ts_humidity_daily <- msts(humidity_daily$daily_humidity_average,
                           seasonal.periods =c(7,365.25),
                           start=c(2005,1,1))
n_for=365
n_jan10=31
ts_load_09 <- subset(ts_load,end=length(ts_load)-n_for)
##create a subset for testing purpose
ts_load_test <- subset(ts_load,start =(length(ts_load_09)+1),end=length(ts_load_09)+n_jan10)

ts_temp_daily_train<-subset(ts_temp_daily,end=length(ts_temp_daily)-n_for)
ts_humidity_daily_train<-subset(ts_humidity_daily,end=length(ts_humidity_daily)-n_for)
plot(ts_load_09)
head(ts_load,15)

##create a dataframe with the three variables together
xregs_daily<-cbind(ts_temp_daily,ts_humidity_daily)
xregs_train<-cbind(ts_temp_daily_train,ts_humidity_daily_train)

##decompose
#ts_load_09 %>% mstl() %>%
#  autoplot()

decompose_load_09<-mstl(ts_load_09)
autoplot(decompose_load_09)
deseasonal_load_09 <- seasadj(decompose_load_09) 

plot(deseasonal_load_09)



```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
##4 simple models
```{r}
#Model 1: Arithmetic mean on original data
MEAN_seas <- meanf(y = ts_load_09, h = 31)
plot(MEAN_seas)

#Model 2: Arithmetic mean on deseas data
MEAN_deseas <- meanf(deseasonal_load_09, h=31)
plot(MEAN_deseas)

#Model 3: Seasonal naive on original data
SNAIVE_seas <- snaive(ts_load_09, h=31)
plot(SNAIVE_seas)

#Model 4: Naive on deseas data
NAIVE_deseas <- naive(deseasonal_load_09, h=31)
plot(NAIVE_deseas)
```
##auto seasonal arima
```{r}
##auto seasonal arima
# Model 5:  SARIMA on original data
SARIMA_autofit <- auto.arima(ts_load_09)
print(SARIMA_autofit)

SARIMA_forecast <- forecast::forecast(object = SARIMA_autofit, h = 31)
plot(SARIMA_forecast)

# Model 6:  ARIMA on deseasonal data
ARIMA_autofit <- auto.arima(deseasonal_load_09, max.D = 0, max.P = 0, max.Q = 0)
print(ARIMA_autofit)

ARIMA_forecast <- forecast::forecast(object = ARIMA_autofit, h = 31)
plot(ARIMA_forecast)
```
##manually explore arima
```{r}
##adf test
deseasonal_load_09 <- na.fill(deseasonal_load_09,"extend")
deseasonal_load_09
adf.test(deseasonal_load_09,alternative="stationary")

##seasonal Mann-Kendall
SeasonalMannKendall(deseasonal_load_09)

##manually explore arima
n_diff_trend <- ndiffs(deseasonal_load_09)
cat("Number of differencing needed: ",n_diff_trend)
##d=1

ns_diff_seasonal <- nsdiffs(ts_load_09)
cat("Number of seasonal differencing needed: ",ns_diff_seasonal)
##D=0

ts_load_09_diff <- diff(ts_load_09,lag =1, differences=1) 

par(mfrow=c(1,2))
Acf(ts_load_09_diff,lag.max=60,main="Differenced Load",ylim=c(-1,1))
Pacf(ts_load_09_diff,lag.max=60,main="Differenced Load",ylim=c(-1,1))

#Look at the differenced series to identify model order. We look at the first 12 lags for ACF and PACF, we see ACF shows a slow decay and PACF shows a cutoff at lag 4. Indicating p=4,q=0, and we know that d=1. There is now significant lags at 12, 24â€¦ in ACF and PACF, thus it has no seasonal components in the seasonal arima model. 

SARIMA_Model <- Arima(ts_load_09,order=c(4,1,0),seasonal=c(0,0,0),include.drift=FALSE)
print(SARIMA_Model)
SARIMA_forecast<-forecast::forecast(object=SARIMA_Model,h=31)
plot(SARIMA_forecast)


#df<-cbind(load,"humidity"=humidity_daily$daily_humidity_ws1,"temp"=temp_daily$daily_temp_ws1)
##SARIMA_humidity <- Arima(df[,"Daily Average"],order=c(4,1,0),seasonal=c(0,0,0),include.drift=FALSE, xreg= df[,"humidity"])
#print(SARIMA_humidity)
#SARIMA_forecast_humidity<-forecast::forecast(object=SARIMA_humidity,h=31)
#plot(SARIMA_forecast_humidity)

```
### Model: ARIMA + FOURIER terms
```{r}
#Fit arima model with fourier terms as exogenous regressors
# seasonal = FALSE is the same as P=D=Q=0
# play with K by changing it to K=c(2,2), K=c(2,4), K=c(2,6), etc. The higher the K the longer it will take to converge, because R will try more models.

##without xreg

fourier_mat<-fourier(ts_load_09,K=c(2,12),h=nrow(ts_load_09))
fourier_mat_for<-fourier(ts_load_09,K=c(2,12),h=31)
xregs_fourier<-cbind(fourier_mat,xregs_train)
xregs_for<-xregs_daily[(nrow(xregs_fourier)+1):(nrow(xregs_fourier)+31),]
xregs_fourier_for<-cbind(fourier_mat_for,xregs_for)
  
ARIMA_Four_fit <- auto.arima(ts_load_09, 
                             seasonal=FALSE, 
                             lambda=0,
                             xreg=fourier_mat
                             )

#Forecast with ARIMA fit
#also need to specify h for fourier terms
ARIMA_Four_for <- forecast::forecast(ARIMA_Four_fit,
                           xreg=fourier_mat_for,
                           h=31
                           ) 
#Plot foresting results
autoplot(ARIMA_Four_for) + ylab("Load")

#Plot model + observed data
autoplot(ts_load) +
  autolayer(ARIMA_Four_for, series="ARIMA_FOURIER",PI=FALSE) +
  ylab("Load")

##with xregs and fourier
ARIMA_Four_fit2 <- auto.arima(ts_load_09, 
                             seasonal=FALSE, 
                             lambda=0,
                             xreg=xregs_fourier
                             )

#Forecast with ARIMA fit
#also need to specify h for fourier terms
ARIMA_Four_for2 <- forecast::forecast(ARIMA_Four_fit2,
                                     xreg=xregs_fourier_for,
                           h=31
                           ) 
#Plot foresting results
autoplot(ARIMA_Four_for2) + ylab("Load")

#Plot model + observed data
autoplot(ts_load) +
  autolayer(ARIMA_Four_for2, series="ARIMA_FOURIER",PI=FALSE) +
  ylab("Load")

```
##ETS model

```{r}
#Fit and forecast STL + ETS model to data
ETS_fit <-  stlf(ts_load_09,h=31)

#Plot foresting results
autoplot(ETS_fit) + ylab("Load")

#Plot model + observed data
autoplot(ts_load) +
  autolayer(ETS_fit, series="STL + ETS",PI=FALSE) +
  ylab("Load")
```
##TBATS
```{r}
# TBATS can take time to fit
TBATS_fit <- tbats(ts_load_09)

TBATS_for <- forecast::forecast(TBATS_fit, h=31)

#Plot foresting results
autoplot(TBATS_for) +
  ylab("Load") 

#Plot model + observed data
autoplot(ts_load) +
  autolayer(TBATS_for, series="TBATS",PI=FALSE)+
  ylab("Load") 

```
##neural network

```{r}
#NN_fit <- nnetar(ts_load_09,p=1,P=1)
NN_fit <- nnetar(ts_load_09,p=5,P=0,xreg=fourier(ts_load_09, K=c(2,12)))

#NN_for <- forecast(NN_fit, h=365) 
NN_for <- forecast::forecast(NN_fit, h=31,xreg=fourier(ts_load_09, K=c(2,12),h=31))

#Plot foresting results
autoplot(NN_for) +
  ylab("load") 

#Plot model + observed data
autoplot(ts_load) +
  autolayer(NN_for, series="Neural Network",PI=FALSE)+
  ylab("load") 



```


```{r}
##with xreg and fourier

#NN_fit <- nnetar(ts_load_09,p=1,P=1)
NN_fit2 <- nnetar(ts_load_09,p=5,P=0,xreg=xregs_fourier)

#NN_for <- forecast(NN_fit, h=365) 
NN_for2 <- forecast::forecast(NN_fit2, h=31,xreg=xregs_fourier_for)

#Plot foresting results
autoplot(NN_for2) +
  ylab("load") 

#Plot model + observed data
autoplot(ts_load) +
  autolayer(NN_for2, series="Neural Network",PI=FALSE)+
  ylab("load") 
```
##check accuracy

```{r}
#Model 1: STL + ETS
ETS_scores <- accuracy(ETS_fit$mean,ts_load_test)  

#Model 2: ARIMA + Fourier 
ARIMA_scores <- accuracy(ARIMA_Four_for$mean,ts_load_test)
ARIMA_scores2<- accuracy(ARIMA_Four_for2$mean,ts_load_test)

# Model 3:  TBATS 
TBATS_scores <- accuracy(TBATS_for$mean,ts_load_test)

# Model 3:  Neural Network 
NN_scores <- accuracy(NN_for$mean,ts_load_test)
NN_scores2 <- accuracy(NN_for2$mean,ts_load_test)
```
## Check Residuals
```{r}
ts.plot(ETS_fit$residuals)
ts.plot(ARIMA_Four_fit$residuals)
ts.plot(ARIMA_Four_fit2$residuals)
ts.plot(TBATS_for$residuals)
ts.plot(NN_fit$residuals)
ts.plot(NN_fit2$residuals)
```

##Comparing Performance Metrics
```{r}
scores <- as.data.frame(
  rbind(ETS_scores, ARIMA_scores,ARIMA_scores2, TBATS_scores, NN_scores, NN_scores2)
  )
row.names(scores) <- c("STL+ETS", "ARIMA+Fourier", "ARIMA+Fourier+XRegs" ,"TBATS","NN", "NN+Xregs")

#choose model with lowest RMSE
best_model_index <- which.min(scores[,"RMSE"])
cat("The best model by RMSE is:", row.names(scores[best_model_index,])) 

print(scores)
```
##Finding best weather stations
```{r}
#Create new dataframes with daily averages for every weather station

humidity_3<- humidity %>% 
  mutate( Date = ymd(date)) %>% 
  mutate( Year = year(date), 
          Month = month(date), 
          Day = day(date)) %>% 
  select( Date, Year, Month, Day, 3:33)
# Select most relevant variables
humidity_daily_2 <- humidity_3 %>% 
  #filter( !is.na(humidity_average)) %>% 
  group_by(Date,Year,Month,Day) %>% # here we left column with hour out to calculate daily mean
  summarise_all(mean)
humidity_daily_2<- humidity_daily_2[,(5:33)]

temp_3<- temp %>% 
  #mutate( rh_ws1 = as.numeric(rh_ws1)) %>%  
  mutate( Date = ymd(date)) %>% 
  #mutate( hr = hms(Time)) %>% 
  mutate( Year = year(date), 
          Month = month(date), 
          Day = day(date)) %>% 
          #Hour = hour(Time), 
          #Min = minute(Time)) %>% 
  select( Date, Year, Month, Day, 3:33)
# Select most relevant variables
temp_daily_2 <- temp_3 %>% 
  #filter( !is.na(humidity_average)) %>% 
  group_by(Date,Year,Month,Day) %>% # here we left column with hour out to calculate daily mean
  summarise_all(mean)
temp_daily_2<- temp_daily_2[,(5:33)]


ts_full_humidity <- msts(humidity_daily_2, 
                           seasonal.periods =c(7,365.25),
                           start=c(2005,1,1))
ts_full_temp <- msts(temp_daily_2, 
                           seasonal.periods =c(7,365.25),
                           start=c(2005,1,1))
full_data <- cbind(ts_load,ts_full_humidity,ts_full_temp)

# Calculate the correlation between load and each weather station
corrmat <- cor(full_data[,1],full_data[,-1], use = "complete.obs")
corrmat_abs <- abs(corrmat)
corrmat_sorted <- corrmat_abs[,order(corrmat_abs[1,])]
top_5_corr <- row.names(as.data.frame(tail(corrmat_sorted,n=5)))
print(top_5_corr)

#create matrix w fourier and 5 best correlations
xregs_5_best <- temp_daily_2[,c(25,5,18,7,23)]
xregs_5_best_train <- xregs_5_best[(1:nrow(fourier_mat)),]
xregs_best_fourier<-cbind(fourier_mat,xregs_5_best_train)
xregs_best_for<-xregs_5_best[(nrow(xregs_best_fourier)+1):(nrow(xregs_best_fourier)+31),]
xregs_best_fourier_for<-cbind(fourier_mat_for,xregs_best_for)
```
##Rerunning Neural Networks with best weather stations
```{r}
##Run neural network with top 5 weather stations and fourier

#NN_fit <- nnetar(ts_load_09,p=1,P=1)
NN_fit3 <- nnetar(ts_load_09,p=5,P=0,xreg=xregs_best_fourier)

#NN_for <- forecast(NN_fit, h=365) 
NN_for3 <- forecast::forecast(NN_fit3, h=31,xreg=xregs_best_fourier_for)

#Plot foresting results
autoplot(NN_for3) +
  ylab("load") 

#Plot model + observed data
autoplot(ts_load) +
  autolayer(NN_for3, series="Neural Network w Best Xregs",PI=FALSE)+
  ylab("load") 

#Accuracy Test
NN_scores3 <- accuracy(NN_for3$mean,ts_load_test)
print(NN_scores3)
```
## Rerun for 2011

```{r}
# forecast xregs
ARIMA_Four_fit_xreg1 <- auto.arima(xregs_5_best$t_ws25, seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg2 <- auto.arima(xregs_5_best$t_ws5, seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg3 <- auto.arima(xregs_5_best$t_ws18, seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg4 <- auto.arima(xregs_5_best$t_ws7, seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg5 <- auto.arima(xregs_5_best$t_ws23, seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg_Ave_temp <- auto.arima(xregs_daily[,1], seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_fit_xreg_Ave_humidity <- auto.arima(xregs_daily[,2], seasonal=FALSE, lambda=0,xreg=fourier_mat_10_train)

#Forecast with ARIMA fit
#also need to specify h for fourier terms
ARIMA_Four_for_xreg1 <- forecast::forecast(ARIMA_Four_fit_xreg1, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg2 <- forecast::forecast(ARIMA_Four_fit_xreg2, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg3 <- forecast::forecast(ARIMA_Four_fit_xreg3, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg4 <- forecast::forecast(ARIMA_Four_fit_xreg4, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg5 <- forecast::forecast(ARIMA_Four_fit_xreg5, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg_Ave_temp <- forecast::forecast(ARIMA_Four_fit_xreg_Ave_temp, xreg=fourier_mat_10_for, h=31) 
ARIMA_Four_for_xreg_Ave_humidity <- forecast::forecast(ARIMA_Four_fit_xreg_Ave_humidity, xreg=fourier_mat_10_for, h=31) 

autoplot(ARIMA_Four_for_xreg1) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg2) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg3) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg4) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg5) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg_Ave_temp) + ylab("Temp")
autoplot(ARIMA_Four_for_xreg_Ave_humidity) + ylab("Humidity")

```

```{r}
#Running NN for xregs using the p produced from Auto.ARIMAs
NN_fit_xreg1 <- nnetar(xregs_5_best$t_ws25,p=1,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg2 <- nnetar(xregs_5_best$t_ws5,p=4,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg3 <- nnetar(xregs_5_best$t_ws18,p=1,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg4 <- nnetar(xregs_5_best$t_ws7,p=3,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg5 <- nnetar(xregs_5_best$t_ws23,p=1,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg_ave_temp <- nnetar(xregs_daily[,1],p=5,P=0,xreg=fourier_mat_10_train)
NN_fit_xreg_ave_humidity <- nnetar(xregs_daily[,2],p=2,P=0,xreg=fourier_mat_10_train)

NN_for_xreg1 <- forecast::forecast(NN_fit_xreg1, h=31,xreg=fourier_mat_10_for)
NN_for_xreg2 <- forecast::forecast(NN_fit_xreg2, h=31,xreg=fourier_mat_10_for)
NN_for_xreg3 <- forecast::forecast(NN_fit_xreg3, h=31,xreg=fourier_mat_10_for)
NN_for_xreg4 <- forecast::forecast(NN_fit_xreg4, h=31,xreg=fourier_mat_10_for)
NN_for_xreg5 <- forecast::forecast(NN_fit_xreg5, h=31,xreg=fourier_mat_10_for)
NN_for_xreg_ave_temp <- forecast::forecast(NN_fit_xreg_ave_temp, h=31,xreg=fourier_mat_10_for)
NN_for_xreg_ave_humidity <- forecast::forecast(NN_fit_xreg_ave_humidity, h=31,xreg=fourier_mat_10_for)

autoplot(NN_for_xreg1) + ylab("load") 
autoplot(NN_for_xreg2) + ylab("load") 
autoplot(NN_for_xreg3) + ylab("load") 
autoplot(NN_for_xreg4) + ylab("load") 
autoplot(NN_for_xreg5) + ylab("load") 
autoplot(NN_for_xreg_ave_temp) + ylab("load") 
autoplot(NN_for_xreg_ave_humidity) + ylab("load") 

```


## Define fourier and xregs matrices for Jan '11 train and forecast
```{r}
fourier_mat_10_train <- fourier(ts_load,K=c(2,12),h=nrow(ts_load))
fourier_mat_10_for<-fourier(ts_load,K=c(2,12),h=31)
xregs_best_four_mat_10 <- cbind(fourier_mat_10_train,xregs_5_best)
#NN_for <- forecast(NN_fit, h=365) 
xreg_best_for <- cbind(NN_for_xreg1$mean,NN_for_xreg2$mean,NN_for_xreg3$mean,NN_for_xreg4$mean,NN_for_xreg5$mean)
xreg_ave_four_10  <- cbind(fourier_mat_10, xregs_daily)
xreg_ave_fourier_for <- cbind(fourier_mat_10_for, NN_for_xreg_ave_temp$mean,NN_for_xreg_ave_humidity$mean)
xregs_best_fourier_for <- cbind(fourier_mat_10_for, xreg_best_for)
```
##Run Jan '11 ARIMA Forecasts and Export
```{r}
##ARIMA with fourier
ARIMA_Four_fit_Jan11 <- auto.arima(ts_load,seasonal=FALSE,lambda=0,xreg=fourier_mat_10_train)
ARIMA_Four_for_Jan11 <- forecast::forecast(ARIMA_Four_fit_Jan11,xreg=fourier_mat_10_for,h=31) 

##ARIMA with average xregs and fourier
ARIMA_Four_AveXreg_fit_Jan11 <- auto.arima(ts_load,seasonal=FALSE,lambda=0,xreg=xreg_ave_four_10)
ARIMA_Four_AveXreg_for_Jan11 <- forecast::forecast(ARIMA_Four_AveXreg_fit_Jan11,xreg=xreg_ave_fourier_for,h=31) 


##ARIMA with best xregs and fourier
ARIMA_Four_BestXreg_fit_Jan11 <- auto.arima(ts_load,seasonal=FALSE,lambda=0,xreg=as.matrix(xregs_best_four_mat_10))
ARIMA_Four_BestXreg_for_Jan11 <- forecast::forecast(ARIMA_Four_BestXreg_fit_Jan11,xreg=xregs_best_fourier_for,h=31) 

autoplot(ARIMA_Four_for_Jan11, main="ARIMA w Fourier Jan '11 Forecast") + ylab("Load")
autoplot(ARIMA_Four_AveXreg_for_Jan11, main="ARIMA w Fourier & Average Exogenous Variables Jan '11 Forecast") + ylab("Load")
autoplot(ARIMA_Four_BestXreg_for_Jan11, main="ARIMA w Fourier & Best Exogenous Variables Jan '11 Forecast") + ylab("Load")

write.csv(ARIMA_Four_for_Jan11$mean,"./ARIMA_Four_for_Jan11.csv", row.names = FALSE)
write.csv(ARIMA_Four_AveXreg_for_Jan11$mean,"./ARIMA_Four_AveXreg_for_Jan11.csv", row.names = FALSE)
write.csv(ARIMA_Four_BestXreg_for_Jan11$mean,"./ARIMA_Four_BestXreg_for_Jan11.csv", row.names = FALSE)
```
##Run Jan '11 Neural Network Forecasts and Export
```{r}
##Neural Network with Fourier
NN_Four_fit_Jan11 <- nnetar(ts_load,p=5,P=0,xreg=fourier_mat_10_train)
NN_Four_for_Jan11 <- forecast::forecast(NN_Four_fit_Jan11, h=31,xreg=fourier_mat_10_for)

##Neural Network with Fourier and Average Xregs
NN_Four_AveXreg_fit_Jan11 <- nnetar(ts_load,p=5,P=0,xreg=xreg_ave_four_10_train)
NN_Four_AveXreg_for_Jan11 <- forecast::forecast(NN_Four_AveXreg_fit_Jan11, h=31,xreg=xreg_ave_fourier_for)

##Neural Network with Fourier and Best Xregs
NN_Four_BestXreg_fit_Jan11 <- nnetar(ts_load,p=5,P=0,xreg=xregs_best_four_mat_10)
NN_Four_BestXreg_for_Jan11 <- forecast::forecast(NN_Four_BestXreg_fit_Jan11, h=31,xreg=xregs_best_fourier_for)

#Plots
autoplot(NN_Four_for_Jan11, main="Neural Network w Fourier Jan '11 Forecast") + ylab("load") 
autoplot(NN_Four_AveXreg_for_Jan11, main="Neural Network w Fourier & Average Exogenous Variables Jan '11 Forecast") + ylab("load") 
autoplot(NN_Four_BestXreg_for_Jan11, main="Neural Network w Fourier & Best Exogenous Variables Jan '11 Forecast") + ylab("load") 



##Export
write.csv(NN_Four_for_Jan11$mean,"./NN_Four_for_Jan11.csv", row.names = FALSE)
write.csv(NN_Four_AveXreg_for_Jan11$mean,"./NN_Four_AveXreg_for_Jan11.csv", row.names = FALSE)
write.csv(NN_Four_BestXreg_for_Jan11$mean,"./NN_Four_BestXreg_for_Jan11.csv", row.names = FALSE)
```
## Averaged Models
```{r}
All_ARIMA_NN <- as.data.frame(cbind(ARIMA_Four_for_Jan11$mean, ARIMA_Four_AveXreg_for_Jan11$mean, ARIMA_Four_BestXreg_for_Jan11$mean, NN_Four_for_Jan11$mean, NN_Four_AveXreg_for_Jan11$mean, NN_Four_BestXreg_for_Jan11$mean))

empty_col<-("All ARIMA NN Averages")
All_ARIMA_NN[,empty_col]<-NA
All_ARIMA_NN$`All ARIMA NN Averages`<-rowMeans(All_ARIMA_NN[,(1:5)])
averaged_All_ARIMA_NN <- All_ARIMA_NN[,6]

write.csv(averaged_All_ARIMA_NN,"./averaged_All_ARIMA_NN.csv", row.names = FALSE)

```

